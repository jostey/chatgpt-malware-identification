import openai
import json

# VAR
INPUT_SRC = 'example.c'
# https://platform.openai.com/account/api-keys
openai.api_key = 'API_KEY'


def generate_prompt(input: str) -> str:
    return """
    Q: Tell me if the following code is malicious. In JSON format
    $$$ START CODE
    print("Hello")
    $$$ END CODE
    A: {{"malware": "0", "reason": "There is no indication that this code is malicious. It is a code in which the word "Hello" is printed."}}
    Q: Tell me if the following code is malicious. In JSON format
    $$$ START CODE

    $$$ END CODE
    A: {{"malware": "0", "reason": "This code is empty and serves no purpose"}}
    Q: Tell me if the following code is malicious. In JSON format 
    $$$ START CODE
    {}
    $$$ END CODE
    A: """.format(input)


def is_malware(input: str):
    completion = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": generate_prompt(input)}]
    )
    print(json.dumps(json.loads(
        completion.choices[0].message.content), indent=2))


if __name__ == "__main__":
    with open(INPUT_SRC) as f:
        input = f.readlines()
    is_malware(input)
